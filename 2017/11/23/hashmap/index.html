<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  
  <title>hashmap | Flog&#39;blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="hashmapæœ€åŸºç¡€çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼Œæˆ‘ä»¬æ ¹æ®ä½¿ç”¨æ–¹æ³•æ¥åˆ†æhashmapæºç 
123HashMap&amp;lt;String, String&amp;gt; hashMap = new HashMap&amp;lt;&amp;gt;();hashMap.put(&quot;a&quot;, &quot;1&quot;);hashMap.get(&quot;a&quot;);
æˆ‘ä»¬å…ˆæ¥çœ‹HashMapçš„æ„é€ å‡½æ•°
1234public HashMap() &amp;#123;  	//è¿™æ˜¯ä¸€ä¸ªåŠ è½½">
<meta property="og:type" content="article">
<meta property="og:title" content="hashmap">
<meta property="og:url" content="https://chanchangxing.me/2017/11/23/hashmap/index.html">
<meta property="og:site_name" content="Flog'blog">
<meta property="og:description" content="hashmapæœ€åŸºç¡€çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼Œæˆ‘ä»¬æ ¹æ®ä½¿ç”¨æ–¹æ³•æ¥åˆ†æhashmapæºç 
123HashMap&amp;lt;String, String&amp;gt; hashMap = new HashMap&amp;lt;&amp;gt;();hashMap.put(&quot;a&quot;, &quot;1&quot;);hashMap.get(&quot;a&quot;);
æˆ‘ä»¬å…ˆæ¥çœ‹HashMapçš„æ„é€ å‡½æ•°
1234public HashMap() &amp;#123;  	//è¿™æ˜¯ä¸€ä¸ªåŠ è½½">
<meta property="og:updated_time" content="2017-12-08T08:08:11.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="hashmap">
<meta name="twitter:description" content="hashmapæœ€åŸºç¡€çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼Œæˆ‘ä»¬æ ¹æ®ä½¿ç”¨æ–¹æ³•æ¥åˆ†æhashmapæºç 
123HashMap&amp;lt;String, String&amp;gt; hashMap = new HashMap&amp;lt;&amp;gt;();hashMap.put(&quot;a&quot;, &quot;1&quot;);hashMap.get(&quot;a&quot;);
æˆ‘ä»¬å…ˆæ¥çœ‹HashMapçš„æ„é€ å‡½æ•°
1234public HashMap() &amp;#123;  	//è¿™æ˜¯ä¸€ä¸ªåŠ è½½">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/typing.css">
  <link rel="stylesheet" href="/css/donate.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">
  
</head>

  
    
      <body class="dark">
    
  
      <div id="container" class="container">
        <article id="post-hashmap" class="article article-type-post" itemscope itemprop="blogPost">
  <header id="header" class="header">
  <nav class="mobile-nav">
    <h1 class="nickname">é“²æ˜¶è¡Œçš„æ™ºéšœç©ºé—´</h1>
    <ul class="mobile-nav-menu">
      <label for="mobile-menu-toggle"><a>&#9776; Menu</a></label>
      <input type="checkbox" id="mobile-menu-toggle"/>
      <ul class="mobile-nav-link">
        
        <a href="/">Home</a>
        
        <a href="/archives">Archives</a>
        
        <a href="/tags/android">Android</a>
        
        <a href="/tags/reactnative/">ReactNative</a>
        
        <a href="/tags/leetcode">Leetcode</a>
        
        <a href="/tags/javascript">JavaScript</a>
        
      </ul>
    </ul>
  </nav>
	
		<nav id="main-nav" class="main-nav nav-left">
	
	
	  <a class="main-nav-link" href="/">Home</a>
	
	  <a class="main-nav-link" href="/archives">Archives</a>
	
	  <a class="main-nav-link" href="/tags/android">Android</a>
	
	  <a class="main-nav-link" href="/tags/reactnative/">ReactNative</a>
	
	  <a class="main-nav-link" href="/tags/leetcode">Leetcode</a>
	
	  <a class="main-nav-link" href="/tags/javascript">JavaScript</a>
	
  </nav>
</header>

  <hr/>
  <div class="article-inner">
    

    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      hashmap
    </h1>
  

      </header>
    
    <div class="article-entry typo" itemprop="articleBody">
      
        <p>hashmapæœ€åŸºç¡€çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼Œæˆ‘ä»¬æ ¹æ®ä½¿ç”¨æ–¹æ³•æ¥åˆ†æhashmapæºç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">HashMap&lt;String, String&gt; hashMap = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">hashMap.put(<span class="string">"a"</span>, <span class="string">"1"</span>);</div><div class="line">hashMap.get(<span class="string">"a"</span>);</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹HashMapçš„æ„é€ å‡½æ•°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span> </span>&#123;</div><div class="line">  	<span class="comment">//è¿™æ˜¯ä¸€ä¸ªåŠ è½½å› å­ï¼Œç›®å‰è¿˜ä¸æ¸…æ¥šä»–çš„ä½œç”¨</span></div><div class="line">	<span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="comment">// all other fields defaulted</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>putæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</div><div class="line">	<span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ä¸€çœ‹hash()è¿™ä¸ªæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> h;</div><div class="line">	<span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å“ˆå“ˆï¼Œæˆ‘**çš„æƒ³ç¬‘æ­»ï¼Œçœ‹åˆ°è¿™ä¸²ç®€å•çš„ä»£ç æˆ‘ç«Ÿç„¶æ‡µé€¼äº†ï¼Œå¯è§æˆ‘çš„javaåŸºç¡€æœ‰å¤šå·®</p>
<p><code>^</code>å¼‚æˆ–æ“ä½œç¬¦ï¼Œè§„åˆ™æ˜¯ï¼šä¸¤ä¸ªæ“ä½œæ•°çš„ä½ä¸­ï¼Œç›¸åŒåˆ™ç»“æœä¸º0ï¼Œä¸åŒç»“æœä¸º1ï¼Œç›´æ¥ä¸Šå®ä¾‹ä»£ç å§</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> a1 = <span class="number">11</span>;</div><div class="line"><span class="keyword">int</span> a2 = <span class="number">13</span>;</div><div class="line">System.out.println(a1 ^ a2);</div><div class="line"></div><div class="line"><span class="comment">//output: 6</span></div><div class="line"><span class="comment">//11çš„äºŒè¿›åˆ¶ä¸º1011ï¼Œ13çš„äºŒè¿›åˆ¶ä¸º1101</span></div><div class="line"><span class="comment">// 1011 ^ 1101 == 0110</span></div></pre></td></tr></table></figure>
<p><code>&gt;&gt;&gt;</code>æ˜¯æ— ç¬¦å·å³ç§»æ¢ä½ç¬¦ï¼Œå³ç§»ä¹‹åè¡¥ä½å…¨ä¸º0</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> a = <span class="number">16</span>;</div><div class="line">System.out.println(a &gt;&gt;&gt; <span class="number">1</span>);</div><div class="line"></div><div class="line"><span class="comment">//output: 8</span></div><div class="line"><span class="comment">//16çš„äºŒè¿›åˆ¶ä¸º10000</span></div><div class="line"><span class="comment">//10000 &gt;&gt;&gt; 1000</span></div></pre></td></tr></table></figure>
<p>ç°åœ¨å…³é”®æ˜¯è¿™ä¸ªhashcode()äº†ï¼Œä½†æ˜¯hashcode()æ˜¯nativeæ–¹æ³•ï¼Œåªèƒ½ä»ç™¾åº¦é‡Œé¢çœ‹çœ‹åˆ°åº•æ˜¯ä»€ä¹ˆäº†ã€‚</p>
<p>ç»è¿‡ä¸€ä¸ªæ™šä¸Šç²—ç•¥æŸ¥æ‰¾ï¼Œè²Œä¼¼æ²¡æœ‰äººçŸ¥é“è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æ¥çœ‹è¿™æ®µä»£ç <code>(key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</code>çš„æ„ä¹‰å§ï¼Œæˆ‘å…ˆè´´ä¸ª<a href="https://www.zhihu.com/question/51784530" target="_blank" rel="external">é“¾æ¥</a>ï¼Œå¤§æ¦‚çš„æ„æ€å°±æ˜¯hashcodeäºŒè¿›åˆ¶ä½æ•°è¾ƒé«˜ï¼Œè€Œè¾ƒä½ä½ç½®éƒ½ä¸º0ï¼Œè€Œhashmapåœ¨è®¡ç®—indexçš„æ—¶å€™åªä¼šå»è®¡ç®—ä½ä½ï¼Œè¿™æ ·çš„è¯å°±ä¼šå‘ç”Ÿhashç¢°æ’ï¼Œåœ¨æˆ‘ä»¥å‰çš„å°è±¡ä¸­è¿™ä¸ªä¸œè¥¿åé¢ä¼šæ˜¾ç¤ºå‡ºä»–çš„ä½œç”¨ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æğŸ‘†ä»£ç ä¸­çš„putValæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent, <span class="keyword">boolean</span> evict)</span> </span>&#123;</div><div class="line">	Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</div><div class="line">	<span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</div><div class="line">      	<span class="comment">//è¿™é‡Œçš„resize()æ˜¯ç”¨æ¥åˆå§‹åŒ–æˆ–è€…å¢åŠ è¡¨çš„å¤§å°çš„ï¼Œä»ifé€»è¾‘åˆ¤æ–­æ¥çœ‹ï¼Œæˆ‘ä»¬è¿™é‡Œç”¨åˆ°çš„åº”è¯¥æ˜¯åˆå§‹åŒ–ã€‚</span></div><div class="line">      	<span class="comment">//æ‰€ä»¥æˆ‘æ¥ä¸‹æ¥å°±å±•ç¤ºresize()åˆå§‹åŒ–çš„ä»£ç ã€‚</span></div><div class="line">		n = (tab = resize()).length;</div><div class="line">	<span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</div><div class="line">		tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</div><div class="line">	<span class="keyword">else</span> &#123;</div><div class="line">		Node&lt;K,V&gt; e; K k;</div><div class="line">         <span class="keyword">if</span> (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</div><div class="line">			e = p;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</div><div class="line">			e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</div><div class="line">		<span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</div><div class="line">				<span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</div><div class="line">					p.next = newNode(hash, key, value, <span class="keyword">null</span>);</div><div class="line">					<span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></div><div class="line">						treeifyBin(tab, hash);</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				p = e;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></div><div class="line">			V oldValue = e.value;</div><div class="line">			<span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</div><div class="line">				e.value = value;</div><div class="line">			afterNodeAccess(e);</div><div class="line">			<span class="keyword">return</span> oldValue;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	++modCount;</div><div class="line">	<span class="keyword">if</span> (++size &gt; threshold)</div><div class="line">		resize();</div><div class="line">	afterNodeInsertion(evict);</div><div class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæ˜¯resizeåˆå§‹åŒ–éƒ¨åˆ†çš„ä»£ç ï¼Œå¯ä»¥ä»ä¸‹é¢çš„ç»“æœçŸ¥é“åˆè¯•è¯è¿”å›çš„æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º16çš„Nodeæ•°åˆ—ï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸‹å…¨å±€å˜é‡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16 ç»“æœä¸º16</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</div><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>; <span class="comment">//ç»“æœä¸º1073741824</span></div><div class="line"></div><div class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</div><div class="line">	Node&lt;K,V&gt;[] oldTab = table;</div><div class="line">	<span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length; <span class="comment">//å› ä¸ºæ²¡æœ‰åˆå§‹åŒ–ï¼Œæ‰€ä»¥oldCapä¸º0</span></div><div class="line">	<span class="keyword">int</span> oldThr = threshold; <span class="comment">//ä¸º0</span></div><div class="line">	<span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</div><div class="line">  	</div><div class="line">  	<span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</div><div class="line">		<span class="comment">//oldCapæ˜¯0ï¼Œçœç•¥</span></div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>)</div><div class="line">		<span class="comment">//oldThræ˜¯0ï¼Œçœç•¥</span></div><div class="line">	<span class="keyword">else</span> &#123;</div><div class="line">		newCap = DEFAULT_INITIAL_CAPACITY;</div><div class="line">		newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); <span class="comment">//ç»“æœä¸º12</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</div><div class="line">		<span class="comment">//newThrä¸ä¸º0ï¼Œçœç•¥</span></div><div class="line">	&#125;</div><div class="line">	threshold = newThr;</div><div class="line">	<span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"rawtypes"</span>,<span class="string">"unchecked"</span>&#125;)</div><div class="line">	Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</div><div class="line">	table = newTab;</div><div class="line">  	</div><div class="line">  	<span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="comment">//oldTab ä¸ºç©º çœç•¥</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> newTab;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰€ä»¥å†å›åˆ°putValæ–¹æ³•ä¸­ï¼Œè¿™é‡Œæˆ‘ä»¬åªå±•ç¤ºåˆå§‹åŒ–çš„ä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent, <span class="keyword">boolean</span> evict)</span> </span>&#123;</div><div class="line">	Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</div><div class="line">	<span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</div><div class="line">		<span class="comment">//æˆ‘ä»¬æ˜¯åˆ†æåˆå§‹åŒ–ï¼Œæ‰€ä»¥è¿™é‡Œnä¸º16</span></div><div class="line">		n = (tab = resize()).length;</div><div class="line">	<span class="comment">//&amp;å’Œå‰é¢è§£é‡Šçš„^å·®ä¸å¤šï¼Œæ“ä½œä½ä¸¤ä¸ªéƒ½ä¸º1ä¸º1ï¼Œå…¶ä½™éƒ½ä¸º0</span></div><div class="line">  	<span class="comment">//å…³é”®æ˜¯è¿™ä¸ªhashæˆ‘ä¸æ¸…æ¥šä»–æ˜¯ä¸ªæ€ä¹ˆæ ·çš„ç»“æœ</span></div><div class="line">  	<span class="comment">//ä½†æ˜¯å› ä¸ºNodeæ•°ç»„åªæ˜¯è¿›è¡Œäº†å®ä¾‹ï¼Œå¾€é‡Œé¢åŠ ä»€ä¹ˆä¸œè¥¿ï¼Œæ‰€ä»¥è¿˜æ˜¯èƒ½è‚¯å®šp==nullæ˜¯ä¸ºtrueçš„</span></div><div class="line">	<span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</div><div class="line">		<span class="comment">//ä¸‹é¢è¦çœ‹çœ‹newNodeæ–¹æ³•</span></div><div class="line">		tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</div><div class="line">	<span class="keyword">else</span> &#123;s</div><div class="line">    	<span class="comment">//çœç•¥...</span></div><div class="line">    &#125;</div><div class="line">  	++modCount;</div><div class="line">  	<span class="comment">//åˆè¯•è¯çš„è¯sizeæ‰ä¸º1ï¼Œæ‰€ä»¥ä¸ä¼šèµ°åˆ°resize()</span></div><div class="line">	<span class="keyword">if</span> (++size &gt; threshold)</div><div class="line">		resize();</div><div class="line">  	<span class="comment">//è¿™æ˜¯ä¸ºLinkedHashMapè®¾è®¡çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆæ”¾ä¸€æ”¾å§ã€‚</span></div><div class="line">	afterNodeInsertion(evict);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯Nodeçš„ä»£ç ï¼Œå…¶ä»–éƒ½å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“äº†ä¼ è¯´ä¸­çš„Entryï¼Œå…³é”®æ˜¯çœ‹åˆ°æ„é€ æ–¹æ³•nextå‚æ•°ï¼Œè¯´ä¸å®šä»–å°±æ˜¯æˆ‘åœ¨ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹ä¸­çœ‹åˆ°çš„æœ«å°¾å“¨å…µ..</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</div><div class="line">	Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</div><div class="line">		<span class="keyword">this</span>.hash = hash;</div><div class="line">		<span class="keyword">this</span>.key = key;</div><div class="line">		<span class="keyword">this</span>.value = value;</div><div class="line">		<span class="keyword">this</span>.next = next;</div><div class="line">	&#125;	</div><div class="line">  </div><div class="line">  	<span class="function">Node&lt;K,V&gt; <span class="title">newNode</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Node&lt;&gt;(hash, key, value, next);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆè¯•è¯çš„putå·²ç»åˆ†æokï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹getæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</div><div class="line">	Node&lt;K,V&gt; e;</div><div class="line">  	<span class="comment">//hashæ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥çœ‹getNodeæ–¹æ³•å§ã€‚</span></div><div class="line">	<span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</div><div class="line">	Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</div><div class="line">	<span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp; (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></div><div class="line">         <span class="comment">//== å’Œ equalsï¼Œå¯èƒ½æ˜¯é’ˆå¯¹äºStringå’Œå¼€å‘è€…è‡ªå·±å®šä¹‰äº†equalsçš„æƒ…å†µå§ã€‚</span></div><div class="line">		((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</div><div class="line">			<span class="keyword">return</span> first;</div><div class="line">		<span class="comment">//..ç›®å‰ä¸ºåˆå§‹åŒ–çŠ¶æ€ï¼Œæ‰€ä»¥çœç•¥</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸¤ç‚¹æƒ³æ³•ï¼š</p>
<p>1.æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>if ((p = tab[i = (n - 1) &amp; hash]) == null)</code>æ¥åæ¨ä¸€ä¸‹hashcodeå¤§æ¦‚çš„å€¼ã€‚æˆ‘ä»¬ä»ä¸Šé¢çš„ä»£ç çš„è®¡ç®—å¯ä»¥çŸ¥é“ï¼Œtabè¿™ä¸ªNode[]çš„åˆå§‹é•¿åº¦ä¸º16ï¼Œç„¶å <code>(n - 1) &amp;hash</code></p>
<p>â€‹    æ‰€ä»¥æ¨ç®—ä¸€ä¸‹-1çš„äºŒè¿›åˆ¶: 1 â€”&gt; 1111111111111111111111111111110 â€”&gt; 1111111111111111111111111111111ã€‚å¾—å‡ºç»“è®ºäº†ï¼Œä¸ <code>(n - 1) &amp;hash = hash</code>ã€‚</p>
<p>è®©æˆ‘ä»¬å›åˆ°ä¹‹å‰ï¼Œé‚£è¡Œä»£ç å¯ä»¥ç®€åŒ–æˆ<code>(p = tab[i = hash])</code>ï¼Œtab[]çš„é•¿åº¦ä¸º16ï¼Œä¹Ÿå°±æ˜¯è¯´hashçš„èŒƒå›´è‚¯å®šæ˜¯0-15ï¼Œä¸ç„¶å°±ä¼šæ•°ç»„è¶Šç•Œï¼Œè€Œ15çš„äºŒè¿›åˆ¶æ˜¯1111â€¦â€¦..æ¨ä¸å‡ºæ¥äº†ï¼Œåœä½äº†â€¦.å¾…ç»­</p>
<p>2.ä¹‹å‰å¯¹äºhashmapçš„è®¤è¯†ï¼ŒçŸ¥é“ä»–æ˜¯ä¸€ä¸ªæ¡¶é‡Œæ˜¯æ”¾ç€LinkedListçš„ï¼Œä½†æ˜¯è¿™é‡Œ<code>tab[i] = newNode(hash, key, value, null);</code>æ”¾å…¥æ˜¯ä¸€ä¸ªNodeç±»ï¼Œçœ‹æ¥ä¹‹åå¯¹äºç›¸åŒçš„indexæ‰ä¼šåšè¿™æ ·çš„æ“ä½œï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ã€‚</p>
<p>ç°åœ¨æ˜¯ç¬¬äºŒæ¬¡æ“ä½œäº†ï¼Œæˆ‘ä»¬å†æŒ‰ç…§æµç¨‹èµ°ä¸€æ³¢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent, <span class="keyword">boolean</span> evict)</span> </span>&#123;</div><div class="line">	Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</div><div class="line">  	<span class="comment">//tab å’Œ n ç«Ÿç„¶åœ¨è¿™é‡Œå®šä¹‰å€¼ï¼ŒçœŸæ˜¯æä¸æ‡‚</span></div><div class="line">	<span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</div><div class="line">		n = (tab = resize()).length;</div><div class="line">	<span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</div><div class="line">		<span class="comment">//æ‰€ä»¥è¿™é‡Œå°±è¢«çœç•¥å•¦ï¼Œä½†æ˜¯påœ¨ifä¸­å®šä¹‰äº†ï¼Œä¹Ÿè¦æ³¨æ„</span></div><div class="line">	<span class="keyword">else</span> &#123;</div><div class="line">		Node&lt;K,V&gt; e; K k;</div><div class="line">		<span class="keyword">if</span> (p.hash == hash &amp;&amp; </div><div class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</div><div class="line">			<span class="comment">//è¿™é‡Œæ˜¯putåˆ°äº†æ­£å¥½æ˜¯å¯¹çš„Entityï¼Œè€Œé™¤äº†è¿™ä¸ªä¹‹å¤–çš„é€»è¾‘éƒ½æ˜¯å› ä¸ºhashç¢°æ’äº†ã€‚</span></div><div class="line">			e = p;</div><div class="line">    	<span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</div><div class="line">			<span class="comment">//è¿™é‡Œæ˜¯pé‡‡ç”¨äº†çº¢é»‘æ ‘ï¼Œå¯¹æ•°æ®ç»“æ„çœŸçš„ä¸äº†è§£ï¼Œäº†è§£äº†å†æ¥åˆ†æè¿™ä¸ª</span></div><div class="line">			e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</div><div class="line">		<span class="keyword">else</span> &#123;</div><div class="line">			<span class="comment">//è¿™é‡Œæ˜¯pé‡‡ç”¨äº†å•é“¾ï¼Œå…ˆåˆ†æè¿™ä¸ª</span></div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</div><div class="line">				<span class="comment">//å¦‚æœpçš„nextä¸ºç©ºçš„è¯ï¼Œé‚£ä¹ˆå°±æŠŠNodeæ”¾åˆ°pçš„nexté‡Œ</span></div><div class="line">				<span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</div><div class="line">					p.next = newNode(hash, key, value, <span class="keyword">null</span>);</div><div class="line">					<span class="comment">//å¦‚æœè¿™ä¸ªbucketçš„é“¾è¶…è¿‡7ä¸ªçš„è¯ï¼Œé‚£ä¹ˆå°±è°ƒç”¨treeifyBinæ–¹æ³•</span></div><div class="line">					<span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></div><div class="line">						treeifyBin(tab, hash);</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				&#125;</div><div class="line">				<span class="comment">//â€œå¦‚æœæœ‰ç›¸åŒçš„hashå’Œkeyï¼Œåˆ™é€€å‡ºå¾ªç¯â€ï¼Œè¯´æ˜å·²ç»æ‰¾åˆ°é€šè¿‡æœ‰ç›¸åŒkeyçš„Entityäº†</span></div><div class="line">				<span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</div><div class="line">					<span class="keyword">break</span>;</div><div class="line">				p = e;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="comment">//è¿™é‡Œå‘ç”Ÿçš„æƒ…å†µå°±æ˜¯æ‰¾åˆ°äº†ç›¸åŒäº†keyçš„Entityï¼Œç„¶åæŠŠvalueæ›¿æ¢å°±å¥½ã€‚</span></div><div class="line">		<span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></div><div class="line">			V oldValue = e.value;</div><div class="line">			<span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</div><div class="line">				e.value = value;</div><div class="line">			afterNodeAccess(e);</div><div class="line">			<span class="keyword">return</span> oldValue;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">  	++modCount;</div><div class="line">	<span class="keyword">if</span> (++size &gt; threshold)</div><div class="line">		resize();</div><div class="line">	afterNodeInsertion(evict);</div><div class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä¸‹é¢treeifyBinæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">treeifyBin</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> hash)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> n, index; Node&lt;K,V&gt; e;</div><div class="line">	<span class="comment">//å¦‚æœtabçš„é•¿åº¦å°äº64çš„è¯ï¼Œé‚£å°±åªå¯¹tabè¿›è¡Œæ‰©å¼ </span></div><div class="line">	<span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)</div><div class="line">		resize();</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> ((e = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</div><div class="line">		TreeNode&lt;K,V&gt; hd = <span class="keyword">null</span>, tl = <span class="keyword">null</span>;</div><div class="line">		<span class="keyword">do</span> &#123;</div><div class="line">			TreeNode&lt;K,V&gt; p = replacementTreeNode(e, <span class="keyword">null</span>);</div><div class="line">			<span class="keyword">if</span> (tl == <span class="keyword">null</span>)</div><div class="line">				hd = p;</div><div class="line">			<span class="keyword">else</span> &#123;</div><div class="line">				p.prev = tl;</div><div class="line">				tl.next = p;</div><div class="line">			&#125;</div><div class="line">			tl = p;</div><div class="line">		&#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</div><div class="line">		<span class="keyword">if</span> ((tab[index] = hd) != <span class="keyword">null</span>)</div><div class="line">			hd.treeify(tab);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æŒ‰ç…§ç°åœ¨çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹æ‰©å¼ å§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</div><div class="line">	Node&lt;K,V&gt;[] oldTab = table;</div><div class="line">	<span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</div><div class="line">	<span class="keyword">int</span> oldThr = threshold;</div><div class="line">	<span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</div><div class="line">	<span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</div><div class="line">		<span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</div><div class="line">			<span class="comment">//...çœç•¥</span></div><div class="line">		&#125;</div><div class="line">		<span class="comment">//è¿™é‡Œå°†æ•°ç»„çš„å¤§å°æ‰©å……ä¸€å€ï¼ŒæŠŠé˜ˆå¢åŠ ä¸€å€</span></div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</div><div class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</div><div class="line">			newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></div><div class="line">		&#125;</div><div class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></div><div class="line">		newCap = oldThr;</div><div class="line">	<span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></div><div class="line">		newCap = DEFAULT_INITIAL_CAPACITY;</div><div class="line">		newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</div><div class="line">		<span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</div><div class="line">		newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</div><div class="line">                  (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</div><div class="line">	&#125;</div><div class="line">	threshold = newThr;</div><div class="line">	<span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"rawtypes"</span>,<span class="string">"unchecked"</span>&#125;)</div><div class="line">	Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</div><div class="line">	table = newTab;</div><div class="line">	<span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</div><div class="line">			Node&lt;K,V&gt; e;</div><div class="line">			<span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</div><div class="line">				oldTab[j] = <span class="keyword">null</span>;</div><div class="line">				<span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</div><div class="line">					newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</div><div class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</div><div class="line">					((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</div><div class="line">				<span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></div><div class="line">					Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</div><div class="line">					Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</div><div class="line">					Node&lt;K,V&gt; next;</div><div class="line">					<span class="keyword">do</span> &#123;</div><div class="line">						next = e.next;</div><div class="line">						<span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</div><div class="line">							<span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</div><div class="line">								loHead = e;</div><div class="line">							<span class="keyword">else</span></div><div class="line">								loTail.next = e;</div><div class="line">							loTail = e;</div><div class="line">						&#125;</div><div class="line">						<span class="keyword">else</span> &#123;</div><div class="line">							<span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</div><div class="line">								hiHead = e;</div><div class="line">							<span class="keyword">else</span></div><div class="line">								hiTail.next = e;</div><div class="line">							hiTail = e;</div><div class="line">						&#125;</div><div class="line">					&#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</div><div class="line">					<span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</div><div class="line">						loTail.next = <span class="keyword">null</span>;</div><div class="line">						newTab[j] = loHead;</div><div class="line">                      &#125;</div><div class="line">					<span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</div><div class="line">						hiTail.next = <span class="keyword">null</span>;</div><div class="line">                          newTab[j + oldCap] = hiHead;</div><div class="line">					&#125;</div><div class="line">                  </div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> newTab;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
      
    </div>
    <footer class="article-footer">
      <ul class="article-meta">
        <li>
          <span class="label">Published Date:</span>
          <a href="/2017/11/23/hashmap/" class="article-date">
  <time datetime="2017-11-23T06:21:51.000Z" itemprop="datePublished">2017-11-23</time>
</a>

        </li>
        
        
          <li>
            <span class="label">Tag:</span>
            
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>


          </li>
        
        <hr/>
      </ul>
    </footer>
  </div>
  
    
<nav id="article-nav" class="article-nav">
  
    <a href="/2017/11/28/Glideç¼“å­˜æœºåˆ¶/" id="article-nav-newer" class="article-nav-link-wrap newer">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Glideç¼“å­˜æœºåˆ¶
        
      </div>
    </a>
  
  
    <a href="/2017/08/03/okhttp/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">okhttp</div>
    </a>
  
</nav>


  
</article>










      </div>
      
    <footer id="footer" class="post-footer footer">
      
        <ul class="footer-links">
          
            <li><a href="/archives/"><span class="fa fa-book"></span></a></li>
          
            <li><a href="https://github.com/chanchangxing"><span class="fa fa-globe"></span></a></li>
          
        </ul>
	    
      <hr/>
      <div id="footerContent" class="footer-content">
        <p>è¿™ç¯‡å†™å®Œå°±åˆ ç«™</p>


      </div>
    </footer>

      







<script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>


<script src="/js/typing.js"></script>
<!--[if lt IE 9]><script src="https://cdn.jsdelivr.net/npm/html5shiv@3/dist/html5shiv.min.js"></script><![endif]-->







    </div>
  </body>
</html>
